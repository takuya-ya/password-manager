# パスワードマネージャー

個人用の簡易パスワードマネージャー（Bash + GPG）。Linux操作とシェルスクリプト学習の成果物です。

---

## 学習の背景

このパスワードマネージャーは、**Linux操作習得と簡単なシェルスクリプト実装の練習** を目的に作成した成果物です。
転職活動を進める中で「WebエンジニアとしてLinux操作やスクリプト記述は基礎スキル」と知り、Bashを用いてファイル操作・入力処理・暗号化などを組み合わせた実装に挑戦しました。

---

## 動作環境

このツールの実行に必要なのは次の2点です：

* **Bash** 3.2以降（zshなど他シェルでは動作未確認）
* **GnuPG (GPG)**  ← 学習時に初めて外部ライブラリ（パッケージ）の導入に挑戦。公式ドキュメントを確認し、正しいコマンド操作やオプションに基づいて実装

※ インストール方法は下記の「セットアップ手順」を参照してください。

---

## セットアップ手順

### macOS

#### 1. Homebrew のインストール

macOSのパッケージマネージャであるHomebrewをインストールします。

```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

インストール後、パスを設定します：

```bash
echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> ~/.zprofile
eval "$(/opt/homebrew/bin/brew shellenv)"
```

#### 2. GPG のインストール

```bash
brew install gnupg
```

### Linux / WSL

#### Ubuntu/Debian (動作確認済み)

```bash
# Linux (Ubuntu/Debian) または WSL (Ubuntu等) の場合
sudo apt update
sudo apt install gnupg
```

### インストールの確認 (全プラットフォーム共通)

GPGが正しくインストールされているか確認します。

```bash
gpg --version
```

バージョン情報が表示されれば、インストールは完了です。

---

## 使用方法

### スクリプトの実行（Unix系: macOS, Linux, WSL）

```bash
chmod +x password_manager.sh
./password_manager.sh
```

### 機能説明

1. メニューが表示されるので、希望のメニューを選択してください。
2. **Add Password**: サービス名、ユーザー名、パスワードを入力して下さい。
   入力内容を暗号化する為、パスフレーズの設定が求められます。尚、復帰処理が未実装の為、パスフレーズを紛失した場合、情報が取得できなくなります。パスフレーズの管理には十分にご注意ください。
3. **Get Password**: 情報を取得したいサービス名を入力して下さい。暗号化ファイル復号化の為、パスフレーズが求められます。
4. **Exit**: パスワードマネージャーを終了します。
5. 復号化の為に入力したパスフレーズは、一定時間キャッシュされる為、その間は入力がスキップされます。

---

## 技術仕様

* **暗号化方式**: GPG対称暗号化
* **対応シェル**: Bash 3.2以降
* **対応OS**:

  * macOS (動作確認済み)
  * Linux / WSL Ubuntu/Debian (動作確認済み)
* **データ形式**: コロン区切りテキスト
* **バリデーション**: 入力値検証とエラーハンドリング

---

## 学びと技術的ポイント

* **ユーザー入力処理**

  * `read` によるサービス名・ユーザー名・パスワード入力受付
  * `-s` オプションを使ったパスワード入力の非表示化

* **ファイル操作**

  * `echo >>` によるファイルへの追記保存
  * `rm` による一時ファイル削除

* **検索・出力処理**

  * `grep` によるサービス名の検索やエラーメッセージ判定
  * `awk` によるデータ整形（サービス名 / ユーザー名 / パスワードの整形表示）
  * `tail -n 1` による直近エラーメッセージの確認

* **暗号化・復号**

  * `gpg` を利用したファイルの暗号化・復号処理
  * `gpgconf --reload gpg-agent` によるセッション管理のリセット

* **エラーハンドリング**

  * `$?` を用いた直前コマンドの終了ステータスによる成否判定
  * 条件分岐で復号失敗時の「パスフレーズ誤り」と「その他の失敗」を区別
  * 配列 `error_messages` による複数バリデーションエラーの収集とまとめて出力

* **スクリプト構造の工夫**

  * `encrypt_file` / `save_user_inputs` / `validate_field` / `add_password` / `get_password` など関数化により可読性を向上
  * 入力検証を独立した関数にまとめ、保守性を意識した設計

---

## 今後の改良予定（優先度順）

1. **エラーメッセージの明確化（致命的欠陥）**

   * gpg復号時に「ファイル未作成」「パスフレーズ誤り」「その他の失敗」を区別して出力
   * 入力検証エラーをユーザーに詳細にフィードバック

2. **ログ運用の改善**

   * `error.txt` を一時バッファ化し、失敗時のみ恒久ログに記録
   * 成功時はログを残さず、誤検知や古いエラーの混在を防止

3. **入力検証の強化**

   * 全角/半角スペースのみの入力を検知
   * 入力値のトリム処理を追加し、予期せぬ空白による不具合を回避

4. **コードの整理と安全性向上**

   * `cleanup()` 関数を導入し、異常終了時でも一時ファイルを安全に削除
   * エラーハンドリングを関数単位に集約し、可読性と保守性を向上

---

## 実務での応用

Webエンジニアとして業務でスクリプトが使われる場面は以下のようなケースです：

1. **デプロイ自動化**

   * **内容**: Gitから最新ソースを取得、依存関係インストール、DBマイグレーション、キャッシュクリア、サービス再起動を一括で実行
   * **メリット**: 手作業の漏れや打ち間違いを防ぎ、複数人で統一手順を共有できる
   * **例**:

     ```bash
     git pull origin main
     php artisan migrate --force
     php artisan config:cache
     sudo systemctl restart nginx
     ```
2. **ログ確認やエラー調査**

   * **内容**: Laravelの `storage/logs/laravel.log` や Nginx の `error.log` を監視・検索
   * **メリット**: 発生したエラーをすぐに見つけられる。定期的に通知する仕組みにもできる
   * **例**:

     ```bash
     tail -f /var/www/app/storage/logs/laravel.log | grep "ERROR"
     ```
3. **データベースバックアップ**

   * **内容**: `mysqldump` を使って定期的にDBをエクスポートし、ファイル保存やクラウドにアップロード
   * **メリット**: 障害や誤操作でデータが消えても復元できる
   * **例**:

     ```bash
     mysqldump -u root -p mydb > backup_$(date +%F).sql
     ```
4. **開発環境の初期化**

   * **内容**: 新しく開発を始める人や壊れた環境をリセットする際に「Docker起動 → .env設定 → マイグレーション実行」を一発で実行
   * **メリット**: 誰でも同じ状態の環境を短時間で再現できる
   * **例**:

     ```bash
     docker-compose up -d
     cp .env.example .env
     php artisan migrate:fresh --seed
     ```
5. **定期ジョブ（スケジューラ）**

   * **内容**: `cron` で一定時間ごとにスクリプトを呼び出し、Laravelの `schedule:run` を実行
   * **メリット**: 毎時・毎日などのバッチ処理（メール送信、集計、削除処理）を自動化できる
   * **例**:

     ```bash
     * * * * * /usr/bin/php /var/www/app/artisan schedule:run >> /dev/null 2>&1
     ```

---

## トラブルシューティング

### GPGコマンドが見つからない場合

#### macOS

```bash
# エラー例: gpg: command not found
# 解決策: GPGをインストール
brew install gnupg
```

#### Linux / WSL

* 標準的なLinuxディストリビューション（Ubuntu/Debian での動作確認済み）
* WSL (Windows Subsystem for Linux) での動作確認済み

---

## まとめ

### 学びの整理

Webエンジニアのスクリプト利用は「再現性・効率化・安定化」を目的にしています。

* 手作業でやると忘れやすい作業 → 自動化スクリプト化
* 繰り返し確認が必要な作業 → 定型スクリプト化
* トラブル時にすぐ実行したい作業 → 調査用スクリプト化

本プロジェクトを通じて、こうした実務でよくあるケースに応用できる基礎を学びました。
